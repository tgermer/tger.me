---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  slug: string;
  title: string;
  description: string;
  type: string;
  technologies: string;
  image: ImageMetadata;
  imageBg?: string;
  featured?: boolean;
}

const { slug, title, description, type, technologies, image, imageBg, featured = false } = Astro.props;
const techList = technologies.split(',').map((t) => t.trim()).slice(0, 3);
const isSvg = image.format === 'svg';
---

<a
  href={`/portfolio/${slug}`}
  class="group block bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 overflow-hidden hover:shadow-lg hover:-translate-y-1 transition-all duration-300"
>
  <!-- Image area -->
  <div class="relative h-48 overflow-hidden">
    {isSvg ? (
      <img
        src={image.src}
        alt={title}
        class={`w-full h-full group-hover:scale-105 transition-transform duration-300 ${imageBg ? 'object-contain p-6' : 'object-cover'}`}
        style={imageBg ? `background-color: ${imageBg};` : undefined}
        loading="lazy"
      />
    ) : (
      <Image
        src={image}
        alt={title}
        class={`w-full h-full group-hover:scale-105 transition-transform duration-300 ${imageBg ? 'object-contain p-6' : 'object-cover'}`}
        style={imageBg ? `background-color: ${imageBg};` : undefined}
        widths={[400, 800]}
        sizes="(min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw"
        loading="lazy"
      />
    )}
    {featured && (
      <span class="absolute top-3 right-3 bg-blue-600 text-white text-xs font-medium px-2 py-1 rounded-full">
        Featured
      </span>
    )}
  </div>

  <!-- Content -->
  <div class="p-5">
    <span class="inline-block bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-xs font-medium px-2.5 py-1 rounded-full mb-2">
      {type}
    </span>
    <h3 class="font-semibold text-gray-900 dark:text-white text-base leading-snug mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
      {title}
    </h3>
    <p class="text-gray-600 dark:text-gray-400 line-clamp-2 mb-4">{description}</p>

    <!-- Tech chips -->
    <div class="flex flex-wrap gap-1.5">
      {techList.map((tech) => (
        <span class="bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-300 text-xs px-2 py-0.5 rounded-full">
          {tech}
        </span>
      ))}
    </div>
  </div>
</a>
