# CLAUDE.md – Project Guide for tger.me

## Project Overview

Personal website & application system built with Astro, Tailwind CSS 4, and TypeScript.
Deployed on Netlify at https://tger.me.

## Tech Stack

- **Framework:** Astro 5 (static site generation)
- **Styling:** Tailwind CSS 4 (via Vite plugin)
- **Fonts:** IBM Plex Sans (@fontsource)
- **Icons:** astro-icon + @iconify-json/tabler
- **PDF:** Playwright (headless Chromium, dev only)
- **Deploy:** Netlify (free tier)
- **CI:** GitHub Actions (PDF generation)

## Commands

```bash
npm run dev              # Start dev server
npm run build            # Build for production
npm run preview          # Preview production build

npm run new-apply        # Create new application (interactive)
npm run delete-apply     # Delete application (interactive selection)
npm run pdf              # Generate all PDFs (skips finalized)
npm run pdf <slug>       # Generate specific PDF (skips if finalized)
npm run pdf --force      # Generate all PDFs (including finalized)
npm run pdf:install      # Install Playwright Chromium (one-time setup)
```

## Application System Architecture

### Two types of resume pages

1. **General resumes** (`/resume-de`, `/resume-en`)
   - Always show current CV data from `src/data/cv_de.ts` / `cv_en.ts`
   - Living documents that update when base data changes

2. **Application-specific pages** (`/apply/<slug>`)
   - Frozen snapshots for specific job applications
   - Each has two files:
     - `src/content/apply/<slug>.md` – Metadata + optional cover letter (markdown body)
     - `src/data/cv_<slug>.ts` – Frozen copy of all CV + personal data
   - Changing `cv_de.ts` does NOT affect existing snapshots

### Cover letter (Anschreiben)

The markdown body of `<slug>.md` (after the frontmatter `---`) serves as the cover letter.
If the body is non-empty, the cover letter is displayed between the cover page and CV,
and a separate PDF (`<slug>-letter.pdf`) is generated.

The letter layout is auto-generated:
- **Sender**: name, location, phone, email from `cv_<slug>.ts` basics data
- **Recipient**: contact name + company from frontmatter
- **Date**: location + application date
- **Subject**: "Bewerbung als {position}" / "Application for {position}"
- **Salutation**: from frontmatter `salutation` field (e.g. "Sehr geehrter Herr Eger,")
- **Body**: rendered markdown content (no salutation — that's in frontmatter)
- **Closing**: "Mit freundlichen Grüßen" / "Best regards," + optional signature + name

### Data flow

```
cv_de.ts / cv_en.ts          ← Base templates (general resume pages read from these)
       ↓ (copied by new-apply.sh)
cv_<slug>.ts                  ← Frozen snapshot (application-specific pages read from these)
       ↓ (referenced via frontmatter)
<slug>.md                     ← Astro content entry (metadata + optional cover letter body)
       ↓ (rendered by)
[slug].astro                  ← Template (cover page → letter → CV)
       ↓ (PDF generated by)
public/apply/<slug>.pdf       ← CV PDF (cover + CV only)
public/apply/<slug>-letter.pdf ← Cover letter PDF (only if body exists)
```

### Personal data (basics)

All personal data lives in the `basics` export of each CV data file.
It includes `name`, `label` (tagline), `image` (photo), `birthdate`, `location` (object with
`address`, `postalCode`, `city`), `phone`, `email`, `url`, `profiles[]`.
Social profiles use `{network, url}` objects. Languages and interests are separate
top-level exports (`languages`, `interests`), not part of `basics` or `skills`.

This means:
- General resume pages use `basics` from `cv_de.ts` / `cv_en.ts`
- Application snapshots use `basics` from `cv_<slug>.ts`
- The `site.ts` file is for website-level config only (not resume data)

### CV data schema (aligned with JSON Resume)

Each CV data file exports: `basics`, `work`, `education`, `certificates`,
`skills`, `languages`, `interests`, `projects`, `references`.

Fields are marked [JR] (JSON Resume standard) or [Custom] in `cv_types.ts`.

Key field names:
- `basics.name`, `.label`, `.image`, `.birthdate` [Custom], `.location` (Location object), `.phone`, `.email`, `.url`, `.profiles[]`
- `work[].name` (company), `.url`, `.location`, `.typeOfEmployment` [Custom], `.position[]`, `.highlights[]`
- `education[].institution`, `.url`, `.area`, `.studyType`, `.score`, `.majorFieldOfStudy` [Custom], `.thesis` [Custom]
- `certificates[].name`, `.issuer`, `.issuerUrl` [Custom], `.url` (cert link), `.degree` [Custom], `.location` [Custom]
- `skills[].name`, `.keywords[]`
- `languages[].language`, `.fluency`
- `interests[].name`, `.keywords[]`
- `projects[].name`, `.urls[]` (Profile[]), `.highlights[]`, `.startDate`
- `references[].name`, `.company` [Custom], `.department` [Custom], `.position` [Custom], `.email` [Custom]

### Frontmatter overrides

The `<slug>.md` frontmatter supports per-application overrides:
- `signature: true/false` – show/hide handwritten signature (default: false)
- `photo: true/false` – show/hide photo on cover page (default: true)

### Creating a new application

```bash
npm run new-apply
```

This creates (interactively):
1. `src/content/apply/<slug>.md` with metadata
2. `src/data/cv_<slug>.ts` as a frozen snapshot of `cv_de.ts`

Then:
- Customize `cv_<slug>.ts` for the specific application (reorder experience, adjust descriptions)
- Optionally add cover letter text to the markdown body of `<slug>.md`

### PDF generation

PDFs are generated locally with Playwright and committed to git.
Netlify serves them as static files – no Playwright needed in production build.

**Finalized applications** with a terminal status (`zusage`, `absage`, `zurückgezogen`)
are automatically skipped during PDF generation. Use `--force` to override.

**Local workflow:**
1. `npm run dev` → preview in browser
2. `npm run pdf <slug>` → generate CV PDF + cover letter PDF (if body exists)
3. Commit and push (PDFs included)

**Remote fallback (GitHub Action):**
When application source files are pushed without updated PDFs, the GitHub Action
automatically generates PDFs and commits them back to the repo.
The workflow skips generation if source files haven't changed since the last PDF commit.
Finalized applications are also skipped (no `--force` in CI).
Can also be triggered manually via `gh workflow run generate-pdfs.yml` or the GitHub UI.

## Content Collections

- `portfolio` – Project showcase entries
- `blog` – Blog posts
- `apply` – Application-specific resumes + cover letters (schema in `src/content/config.ts`)

## Non-Breaking Spaces in CV Data Files

CV data files (`cv_de.ts`, `cv_en.ts`, `cv_<slug>.ts`) contain intentional **non-breaking spaces** (U+00A0, `\xC2\xA0`) for typographic correctness. These MUST be preserved when editing.

Common patterns:
- `&` + NBSP before the next word (prevents `&` from being orphaned at line end)
- `z.` + NBSP + `B.` (German abbreviation "z. B." must not break)
- Number + NBSP + `%` (e.g. `30 %` — number and unit stay together)
- Acronym + NBSP + numeral (e.g. `PSM I`, `PSPO I`)

**When editing these files, never replace non-breaking spaces with regular spaces.**
NBSPs are invisible in most editors — if in doubt, verify with `grep -n $'\xc2\xa0' <file>`.

## File Structure (Application-related)

```
src/
├── content/
│   ├── config.ts              ← Zod schemas for content collections
│   └── apply/
│       └── <slug>.md          ← Application metadata + cover letter body
├── data/
│   ├── site.ts                ← Website-level config
│   ├── cv_de.ts               ← German CV base template
│   ├── cv_en.ts               ← English CV base template
│   └── cv_<slug>.ts           ← Frozen application snapshots
├── layouts/
│   └── ResumeLayout.astro     ← HTML shell for resume pages
├── pages/
│   ├── resume-de.astro        ← General German resume
│   ├── resume-en.astro        ← General English resume
│   └── apply/
│       ├── index.astro        ← Application overview (password-protected)
│       └── [slug].astro       ← Dynamic application page (cover + letter + CV)
├── styles/
│   └── global.css             ← All styles incl. print CSS (@media print)
scripts/
├── new-apply.sh               ← Creates new application (MD + TS snapshot)
├── delete-apply.sh            ← Deletes application and all associated files
└── generate-pdf.mjs           ← Generates PDFs via Playwright
public/
└── apply/
    ├── <slug>.pdf             ← CV PDFs (committed to git)
    └── <slug>-letter.pdf      ← Cover letter PDFs (committed to git)
.github/
└── workflows/
    └── generate-pdfs.yml      ← Auto-generates PDFs on push
```
